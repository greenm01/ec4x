# EC4X Rule-Based AI Configuration
# All RBA tuning parameters centralized for balance testing
#
# This configuration system enables:
# - Balance testing without recompilation
# - Genetic algorithm parameter evolution
# - A/B testing of different AI behaviors
# - Rapid iteration during AI development
#
# IMPORTANT: All field names use snake_case to match engine config convention
# TOML structure mirrors the Nim type definitions in src/ai/rba/config.nim

# ==============================================================================
# STRATEGY PERSONALITIES (12 strategies × 6 traits)
# ==============================================================================
# Each strategy defines a unique AI personality with weighted preferences
# Traits range from 0.0 (minimum) to 1.0 (maximum)

[strategies_aggressive]
aggression = 0.9
risk_tolerance = 0.8
economic_focus = 0.5
expansion_drive = 0.8
diplomacy_value = 0.2
tech_priority = 0.4

[strategies_economic]
aggression = 0.3
risk_tolerance = 0.3
economic_focus = 0.9
expansion_drive = 0.5
diplomacy_value = 0.6
tech_priority = 0.8

[strategies_espionage]
aggression = 0.5
risk_tolerance = 0.6
economic_focus = 0.5
expansion_drive = 0.65
diplomacy_value = 0.4
tech_priority = 0.6

[strategies_diplomatic]
aggression = 0.3
risk_tolerance = 0.4
economic_focus = 0.6
expansion_drive = 0.5
diplomacy_value = 0.9
tech_priority = 0.5

[strategies_balanced]
aggression = 0.4
risk_tolerance = 0.5
economic_focus = 0.7
expansion_drive = 0.5
diplomacy_value = 0.6
tech_priority = 0.5

[strategies_turtle]
aggression = 0.1
risk_tolerance = 0.3
economic_focus = 0.7
expansion_drive = 0.4
diplomacy_value = 0.7
tech_priority = 0.7

[strategies_expansionist]
aggression = 0.6
risk_tolerance = 0.7
economic_focus = 0.4
expansion_drive = 0.95
diplomacy_value = 0.3
tech_priority = 0.3

[strategies_tech_rush]
aggression = 0.2
risk_tolerance = 0.4
economic_focus = 0.8
expansion_drive = 0.4
diplomacy_value = 0.7
tech_priority = 0.95

[strategies_raider]
aggression = 0.85
risk_tolerance = 0.9
economic_focus = 0.4
expansion_drive = 0.6
diplomacy_value = 0.1
tech_priority = 0.5

[strategies_military_industrial]
aggression = 0.7
risk_tolerance = 0.5
economic_focus = 0.75
expansion_drive = 0.6
diplomacy_value = 0.3
tech_priority = 0.6

[strategies_opportunistic]
aggression = 0.5
risk_tolerance = 0.6
economic_focus = 0.6
expansion_drive = 0.6
diplomacy_value = 0.5
tech_priority = 0.5

[strategies_isolationist]
aggression = 0.15
risk_tolerance = 0.2
economic_focus = 0.85
expansion_drive = 0.3
diplomacy_value = 0.2
tech_priority = 0.75

# ==============================================================================
# BUDGET ALLOCATIONS BY GAME ACT
# ==============================================================================
# Budget percentages for each build objective across the 4-act game progression
# All percentages should sum to 1.0 per act
#
# Build objectives:
# - Expansion: Colony ships (ETACs), facilities (spaceports, shipyards)
# - Defense: Defensive fleets, starbases
# - Military: Combat ships (capital, escort)
# - Reconnaissance: Scouts for ELI mesh and espionage
# - Special_units: Transports, fighters, specialized ships
# - Technology: Research investment

[budget_act1_land_grab]
expansion = 0.45       # Maximum expansion during land grab
defense = 0.10         # Low priority - personality-driven (homeworld-only for most AIs)
military = 0.15        # Reduced from 0.20 - shift to transports for Act 2 prep
reconnaissance = 0.10  # Reduced from 0.30 - any ship can explore in Act 1
special_units = 0.15   # Increased from 0.10 - need transports for invasion capability
technology = 0.05      # Add minimal tech investment
filler_budget_reserved = 0.20  # 20% reserved for capacity utilization (Gap Fix)

[budget_act2_rising_tensions]
expansion = 0.20       # INCREASED from 0.10 - need facilities at new colonies (spaceports/shipyards)
defense = 0.15         # Unchanged - maintain colony defense
military = 0.15        # REDUCED from 0.25 - shift budget to expansion infrastructure
reconnaissance = 0.15  # Unchanged - scouts for espionage
special_units = 0.30   # Unchanged - carriers+fighters critical
technology = 0.05      # Unchanged - minimal investment
filler_budget_reserved = 0.15  # 15% reserved for capacity utilization (Gap Fix)
    
[budget_act3_total_war]
expansion = 0.15       # INCREASED from 0.10 - continue facility scaling at mid-game colonies
defense = 0.10         # REDUCED from 0.15 - shift to expansion
military = 0.45        # Unchanged - war economy
reconnaissance = 0.05  # Unchanged - scouts already deployed
special_units = 0.15   # Unchanged - maintain carriers/fighters
technology = 0.10      # Unchanged - tech investment
filler_budget_reserved = 0.10  # Reduced to 10% for Act 3
    
[budget_act4_endgame]
expansion = 0.10       # INCREASED from 0.05 - finish facility scaling at late colonies
defense = 0.05         # REDUCED from 0.10 - shift to expansion
military = 0.55        # Unchanged - all-in on military
reconnaissance = 0.05  # Unchanged - recon complete
special_units = 0.15   # Unchanged - maintain specialized assets
technology = 0.10      # Unchanged - tech investment
filler_budget_reserved = 0.05  # Reduced to 5% for Act 4

# ==============================================================================
# TACTICAL PARAMETERS
# ==============================================================================
# Operational limits for fleet movements and responses

[tactical]
response_radius_jumps = 3        # Maximum distance for fleet response to threats
max_invasion_eta_turns = 8       # Maximum ETA for invasion operations
max_response_eta_turns = 5       # Maximum ETA for defensive responses

# ==============================================================================
# STRATEGIC PARAMETERS
# ==============================================================================
# Combat engagement thresholds

[strategic]
attack_threshold = 0.6           # Minimum strength ratio to attack (balanced)
aggressive_attack_threshold = 0.4 # Minimum ratio for aggressive personalities
retreat_threshold = 0.3          # Strength ratio triggering retreat

# ==============================================================================
# ECONOMIC PARAMETERS
# ==============================================================================
# Terraforming costs by planet class transition (in PP)

[economic]
terraforming_costs_extreme_to_desolate = 60
terraforming_costs_desolate_to_hostile = 150
terraforming_costs_hostile_to_harsh = 350
terraforming_costs_harsh_to_benign = 850
terraforming_costs_benign_to_lush = 2100
terraforming_costs_lush_to_eden = 5100

# ==============================================================================
# ORDERS PARAMETERS
# ==============================================================================
# Order generation parameters and thresholds

[orders]
research_max_percent = 0.25      # Maximum research budget (% of treasury)
espionage_investment_percent = 0.03  # Espionage budget (% of original treasury)
scout_count_act1 = 3             # Reduced from 5 - minimal scouting in Act 1
scout_count_act2 = 8             # Increased from 7 - ELI mesh priority in Act 2
scout_count_act3_plus = 10       # Increased from 9 - full coverage in Act 3+

# ==============================================================================
# LOGISTICS PARAMETERS
# ==============================================================================
# Mothballing and fleet management thresholds

[logistics]
mothballing_treasury_threshold_pp = 900      # Treasury level triggering mothballing consideration
mothballing_maintenance_ratio_threshold = 0.10  # Maintenance/production ratio triggering mothballing
mothballing_min_fleet_count = 3              # Minimum fleets before considering mothballing

# ==============================================================================
# FLEET COMPOSITION BY DOCTRINE
# ==============================================================================
# Target fleet composition ratios for different combat doctrines

[fleet_composition_balanced]
capital_ratio = 0.40
escort_ratio = 0.40
specialist_ratio = 0.20

[fleet_composition_aggressive]
capital_ratio = 0.50
escort_ratio = 0.35
specialist_ratio = 0.15

[fleet_composition_defensive]
capital_ratio = 0.30
escort_ratio = 0.50
specialist_ratio = 0.20

# ==============================================================================
# THREAT ASSESSMENT
# ==============================================================================
# Thresholds for threat level classification

[threat_assessment]
critical_threshold = 0.8
high_threshold = 0.6
moderate_threshold = 0.4
low_threshold = 0.2

# ==============================================================================
# ADMIRAL CONFIGURATION
# ==============================================================================
# Strategic fleet rebalancing for act-specific objectives

[domestikos]
enabled = true                      # Enable domestikos module for colony defense distribution
split_threshold_act1 = 2            # Split fleets with 2+ ships in Act 1
merge_threshold_act2 = 3            # Merge when 3+ idle single-ship fleets
rendezvous_preference = "homeworld" # Where to merge fleets: homeworld, frontline, center
max_invasion_eta_turns = 8          # Maximum ETA for invasion operations

# ZeroTurnCommand Fleet Management (Immediate-execution fleet operations)
fleet_management_enabled = true     # Enable merge/detach/transfer using ZeroTurnCommand API
                                    # Act 1: Detach ships for exploration coverage
                                    # Act 2+: Merge fleets for combat power, detach scouts for recon
                                    # All Acts: Transfer ships to optimize fleet compositions

# Phase 3: Build Requirements System (Requirements-driven ship production)
build_requirements_enabled = true   # Enable requirements-driven build system (IMMEDIATE ROLLOUT)
defense_gap_detection_enabled = true
defense_gap_max_distance = 5        # Max jump distance to consider for defense
offensive_requirements_enabled = true
critical_priority_homeworld = true  # Always Critical priority for homeworld
high_priority_production_threshold = 50  # Industry threshold for High priority
threat_assessment_radius = 3        # Jumps to check for enemy fleets

# Strategic Triage Budget Reserves (Wise Admiral - maintain awareness)
min_recon_budget_percent = 0.10     # Minimum 10% for reconnaissance
min_expansion_budget_percent = 0.05 # Minimum 5% for expansion

# Escalation Thresholds (Engaging AI - responds to player actions)
escalation_low_to_medium_turns = 3  # Low → Medium after 3 turns undefended
escalation_medium_to_high_turns = 5 # Medium → High after 5 turns
escalation_high_to_critical_turns = 7  # High → Critical after 7 turns

# Intelligence-Driven Ship Building (Phase F)
# Squadron capacity awareness and intelligence-driven requirements
capacity_high_utilization_threshold = 0.9  # Defer non-critical requirements at 90%+ capacity
scouts_per_stale_intel_system = 0.5        # 1 scout per 2 stale intel systems
scouts_per_enemy_house = 1.0               # 1 scout per enemy house for espionage
max_scouts_act1 = 3                        # Minimal scouts in Act 1 (any ship explores)
etacs_per_uncolonized_system = 0.5         # 1 ETAC per 2 uncolonized systems
max_etacs_queued = 5                       # Cap ETAC production at 5

# Offensive building (personality-modulated)
aggressive_transport_ratio = 0.33          # Aggressive AI: 1 transport per 3 colonies
aggressive_marine_per_transport = 1        # 1 marine division per transport
reactive_invasion_multiplier = 1.5         # Defensive AI: 1.5x enemy defenses for invasion

# Fighter/Carrier requirements (threat-based)
fighter_threat_threshold_low = 0.2         # Threat > 0.2 = threatened colony
fighter_threat_threshold_high = 0.5        # Threat > 0.5 = high-threat colony
max_fighters = 20                          # Cap total fighters at 20
fighters_per_carrier = 4                   # 1 carrier per 4 fighters
max_carriers = 6                           # Cap total carriers at 6

# ==============================================================================
# EPARCH PARAMETERS (Economic Administration)
# ==============================================================================
# Colony management: auto-repair, tax rates, dock allocation

[eparch]
auto_repair_threshold = 100  # Min treasury (PP) to enable auto-repair at colonies
                             # Below this: disable auto-repair to conserve PP
                             # Above this: enable for convenience

# ==============================================================================
# INTELLIGENCE INTEGRATION (Phase B+)
# ==============================================================================
# Enhanced intelligence processing from engine intelligence reports
# Enables RBA to utilize ColonyIntelReport, SystemIntelReport, etc.

[intelligence]
# Report freshness thresholds (turns)
colony_intel_stale_threshold = 10      # Colony reports stale after 10 turns
system_intel_stale_threshold = 5       # Fleet movement stale after 5 turns
starbase_intel_stale_threshold = 15    # Economic/tech intel stale after 15 turns

# Threat assessment weights (must sum to 1.0)
threat_fleet_strength_weight = 0.4     # Fleet strength contribution to threat
threat_proximity_weight = 0.3          # Distance contribution to threat
threat_recent_activity_weight = 0.3    # Recent hostile actions contribution

# Threat distance thresholds (jumps)
threat_critical_distance = 1           # Enemy 1 jump away = Critical
threat_high_distance = 2               # Enemy 2 jumps away = High
threat_moderate_distance = 4           # Enemy 4 jumps away = Moderate

# Vulnerability assessment
vulnerability_defense_ratio_threshold = 0.3  # Defender/Attacker < 0.3 = vulnerable
vulnerability_value_threshold = 50           # Min production to be high-value target

# Combat learning (Phase C)
combat_report_learning_enabled = true   # Learn from combat encounters
combat_lesson_retention_turns = 50      # Remember lessons for 50 turns
combat_doctrine_detection_threshold = 3 # Detect doctrine after 3 battles

# Economic intelligence (Phase C)
economic_assessment_min_colonies = 2    # Need 2+ known colonies for assessment
economic_strength_production_weight = 0.6
economic_strength_income_weight = 0.4

# Research intelligence (Phase C)
tech_gap_critical_threshold = 3         # 3+ tech levels behind = critical gap
tech_gap_high_threshold = 2             # 2 tech levels behind = high priority

[intelligence_threat_response]
# Threat-aware budget allocation (Phase D)
low_threat_boost = 0.10
moderate_threat_boost = 0.30
high_threat_boost = 0.50
critical_threat_boost = 1.00
multi_threat_multiplier = 1.5
defense_boost_ratio = 0.6
military_boost_ratio = 0.4

[intelligence_surveillance]
# Surveillance gap priority weights (Phase D)
border_system_priority = 0.9
high_value_priority = 0.8
transit_route_priority = 0.6
recent_activity_priority = 0.7

[intelligence_diplomatic_events]
# Diplomatic event analysis (Phase E)
war_significance_threshold = 8
alliance_significance_threshold = 7
blockade_critical_threshold = 0.4

[intelligence_counterintel]
# Counter-intelligence priorities (Phase E)
high_frequency_threshold = 3
detection_success_threshold = 0.6
priority_boost_espionage = 0.15

[intelligence_construction_analysis]
# Construction trend detection (Phase E)
buildup_threshold_shipyards = 2
velocity_threat_threshold = 1.5
observation_window_turns = 10

[intelligence_patrol_detection]
# Patrol pattern recognition (Phase E)
min_sightings_for_pattern = 3
pattern_confidence_threshold = 0.7
staleness_threshold_turns = 5

[drungarius]
# Intelligence coordinator settings
intel_processing_enabled = true         # Enable enhanced intelligence processing
use_combat_lessons = true              # Use CombatEncounterReport for learning (Phase C)
use_starbase_surveillance = true       # Use StarbaseSurveillanceReport (Phase D)
prioritize_high_value_targets = true   # Focus espionage on valuable targets

# ==============================================================================
# GAP FIXES (Phase 1-2)
# ==============================================================================
# Configuration for architectural improvements to RBA system

[feedback_system]
# Rich feedback generation (Gap 6)
enabled = true
suggest_cheaper_alternatives = true
min_partial_fulfillment_ratio = 0.25

[reprioritization]
# Enhanced reprioritization logic (Gap 4)
enable_quantity_adjustment = true
min_quantity_reduction = 1
enable_substitution = true
max_cost_reduction_factor = 0.6
facility_critical_to_high_turns = 10
facility_high_to_medium_turns = 20

[standing_orders_integration]
# Standing order integration (Gap 5)
generate_support_requirements = true
defense_gap_priority_boost = 1
filler_standing_order_bias = 0.3
track_colony_defense_history = true
max_history_entries = 50

# ==============================================================================
# EPARCH INDUSTRIAL INVESTMENT
# Source: Previously hardcoded in industrial_investment.nim
# ==============================================================================

[eparch_industrial]
# RESOLVED: Match economy.toml (100.0) - was 200.0
iu_growth_divisor = 100.0           # IU passive growth divisor
iu_payback_threshold_turns = 10     # Investment payback threshold
iu_affordability_multiplier = 3     # Treasury safety multiplier (cost * 3)
iu_investment_fraction = 0.25       # Invest 25% of IU deficit
iu_minimum_investment = 10          # Minimum 10 IU per investment

# ==============================================================================
# TREASURY THRESHOLDS
# Source: Previously hardcoded across RBA modules
# ==============================================================================

[treasury_thresholds]
terraform_minimum = 800             # Min treasury for terraforming decisions
terraform_buffer = 200              # Reserve buffer for terraforming
transfer_healthy = 500              # Healthy treasury for logistics transfers
salvage_critical = 100              # Critical threshold for salvage decisions
reactivation_healthy = 1000         # Healthy treasury for reactivation

# ==============================================================================
# AFFORDABILITY CHECKS
# Source: Previously hardcoded in build_requirements.nim
# ==============================================================================

[affordability_checks]
# Treasury multipliers for different build decisions
general_multiplier = 1.5            # General affordability check (1.5x cost)
shield_multiplier = 2.0             # Shield affordability check (2x cost)
critical_multiplier = 3.0           # Critical threshold check (3x cost)

# ==============================================================================
# GOAP STRATEGIC PLANNING
# ==============================================================================
# Goal-Oriented Action Planning for multi-turn strategic decision making
# Status: MVP integration (Fleet + Build domains only)

[goap]
enabled = true                          # Enabled for MVP integration testing
planning_depth = 3                      # Max turns to plan ahead
confidence_threshold = 0.5              # Min confidence to execute plan
max_concurrent_plans = 3                # Limit active plans
defense_priority = 0.8                  # Weight for defensive goals
offense_priority = 0.6                  # Weight for offensive goals
log_plans = true                        # Debug logging (enable for MVP)
budget_guidance_boost_factor = 0.3      # GOAP budget estimates boost RBA requirements
replan_stalled_turns = 3                # Replan if no progress for 3 turns
replan_budget_shortfall_ratio = 0.8     # Replan if remaining cost > 80% of treasury
new_opportunity_scan_frequency = 2      # Check for new opportunities every 2 turns

