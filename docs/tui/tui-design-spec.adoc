= EC4X TUI Design Spec
:status: Draft
:scope: Design only (no runtime config)

== Purpose
Define the EC4X text UI layout, navigation, and visual language for
implementation in `src/player/`. This is a design spec only. It does not
introduce runtime configuration or a layout engine.

== Goals
* Preserve the classic EC atmosphere while improving usability.
* Keep always-on empire context visible across views.
* Support fast keyboard navigation with clear hotkey hints.
* Maintain consistent, reusable UI patterns.

== Non-Goals
* Hot reload or runtime layout configuration.
* Fully declarative widget trees.
* Reusable UI framework for other games.

== Viewport Targets
* Minimum supported width: 120 columns
* Target height: 32+ rows

Responsive rules:
* If width < 120, block UI and show a terminal-too-narrow message.
* Suggested message: `Terminal too narrow (need 120 cols, have NN).`

Example (narrow terminal):
----
┌────────────────────────────────────────────────────────────────────────┐
│                                                                        │
│        Terminal too narrow (need 120 cols, have 96).                   │
│                                                                        │
│        Resize your terminal to continue.                               │
│                                                                        │
└────────────────────────────────────────────────────────────────────────┘
----

== Screen Regions
----
+------------------------------------------------------------------------------+
| HUD STRIP (2 lines)                                                          |
|   Left: Empire + Turn    Center: Prestige/Treasury/Prod/C2    Right: Alerts  |
+------------------------------------------------------------------------------+
| BREADCRUMB LINE (1 line)                                                     |
|   Home > Fleets > Alpha Patrol                                               |
+------------------------------------------------------------------------------+
|                                                                              |
| MAIN CANVAS (variable height)                                                |
|   - All windows in the main canvas are modal overlays                         |
|   - Centered floating modals for 9 primary views                             |
|   - Single-line borders (--) for modals and overlays                         |
|                                                                              |
+------------------------------------------------------------------------------+
| STATUS BAR (1 line)                                                          |
|   <1> OVR  <2> PLN  <3> FLT ... <:> EXPERT    or    :command input_          |
+------------------------------------------------------------------------------+
----

== Shared Systems

=== Intel Freshness (LTU)
LTU tracks intel freshness for the player view (fog-of-war), not authoritative
game state.

LTU storage in PlayerState:
* ltuSystems: Table[SystemId, int32]
* ltuColonies: Table[ColonyId, int32]
* ltuFleets: Table[FleetId, int32]
* No ship-level LTU

LTU rules:
* Owned assets: LTU = current turn.
* Uncolonized systems: use ltuSystems[systemId] or "—".
* Colonized systems: use ltuColonies[colonyId] if present, else fall back to
  ltuSystems[systemId].

LTU implementation checklist:
* PlayerState includes ltuSystems, ltuColonies, ltuFleets
* ltuSystems populated from VisibleSystem.lastScoutedTurn
* ltuColonies populated from VisibleColony.intelTurn
* ltuFleets populated from VisibleFleet.intelTurn
* Owned assets set to current turn
* LTU serialized in full snapshot + delta
* Planets view uses colony LTU with system fallback
* Fleets view uses fleet LTU
* Display format T##, missing shows "—"

== Primary Views
* `1` Overview
* `2` Planets
* `3` Fleets
* `4` Research
* `5` Espionage
* `6` Economy
* `7` Reports
* `8` Messages
* `9` Settings
* `Q` Quit

=== Fleets View (Draft)
See Intel Freshness (LTU) for LTU rules (fleet rows use ltuFleets).

=== Planets View (Draft)
Intent: a single full-width modal table in the Main Canvas.
See Intel Freshness (LTU) for LTU rules.

Ordering:
* Owned systems pinned to the top.
* Homeworld first, then owned systems alphabetical by system name.
* Remaining systems alphabetical by system name.

Columns (120 cols target):
* System (name)
* Sector (system coords)
* Owner (house name or "Unknown")
* Class (planet class)
* Resources (resource rating)
* Pop (PU)
* IU
* GCO
* NCV
* Growth
* CD (construction dock capacity)
* RD (repair dock capacity)
* LTU (last turn updated, format `T##`)
* Status (BLK/CAP/CN/TF)

Capacity notes:
* CD: total construction dock capacity from production facilities.
* RD: total repair dock capacity from drydocks.

Column budget (120 cols target):
* System: 18
* Sector: 5
* Owner: 10
* Class: 7
* Res: 5
* Pop: 5
* IU: 5
* GCO: 6
* NCV: 6
* Growth: 7
* CD: 3
* RD: 3
* LTU: 4
* Status: 21 (expand to fill remaining width)

Column alignment spec:
----
System: width=18  align=left   truncate=ellipsis
Sector: width=5   align=center truncate=none
Owner:  width=10  align=left   truncate=ellipsis
Class:  width=7   align=left   truncate=none
Res:    width=5   align=left   truncate=none
Pop:    width=5   align=right  truncate=none
IU:     width=5   align=right  truncate=none
GCO:    width=6   align=right  truncate=none
NCV:    width=6   align=right  truncate=none
Growth: width=7   align=right  truncate=none
CD:     width=3   align=right  truncate=none
RD:     width=3   align=right  truncate=none
LTU:    width=4   align=right  truncate=none
Status: width=fill align=left  truncate=ellipsis
----

Truncation note:
* Use ASCII `...` in code for predictable width.

Table sketch (full separators):
----
┌──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│SYSTEM            │SECTR│OWNER     │CLASS  │RES  │ POP │ IU  │ GCO │ NCV │GROWTH│CD │RD │LTU │STATUS                  │
├──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│Caladan           │A01  │Atreides  │Benign │Rich │ 120 │  80 │  400│  220│  +1.2│ 10│  8│ T12│OK                      │
│Arrakis           │C03  │Atreides  │Harsh  │Abnd │  60 │  40 │  180│   96│  +0.6│  6│  4│ T12│CN                      │
│Ix                │B09  │Unknown   │Lush   │Rich │  90 │  70 │  320│  180│  +0.9│  8│  6│ T10│BLK CAP                 │
│Spatharokandidatos│D07  │—         │Desol  │Poor │  —  │  —  │   — │   — │   —  │  —│  —│  — │—                       │
└──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘
----

Status legend:
* OK: no special status
* BLK: blockaded
* CAP: capacity violation
* CN: construction active
* TF: terraforming active

Summary row (below table):
* Owned: N | Colonized: N | GCO: N | NCV: N | Alerts: N

Owner visibility:
* "Unknown" when fog-of-war hides the owner.
* "—" for uncolonized systems.

LTU definition:
* Last Turn Updated in the player's intel view (fog-of-war freshness).

Filters (draft):
* Owned only
* Colonized only
* Facilities present
* Alerts only

Key map (draft):
* `Enter` View system/colony details
* `B` Build (if facilities allow)
* `S` Sort
* `F` Filter
* `X` Toggle selection
* `A` Apply (bulk)
* `?` Help

=== Fleet Command Console (Draft)
Intent: fast, multi-fleet command and per-ship zero-turn management.

Layout sketch:
----
┌─ EC4X Fleet Command ─ Turn 12 ─ House Atreides ──────────────────────────────┐
│                                                                              │
│ ┌─ Systems (5) ──────────────────────┐  ┌─ Arrakis (3) ────────────────────┐ │
│ │SYSTEM                       │SECT  │  │FLEET│AS  │DS  │CMD   │DST  │ETA  │ │
│ │─────────────────────────────┼──────│  │─────┼────┼────┼──────┼─────┼─────│ │
│ │> Spatharokandidatos         │D07   │  │> 02 │100 │300 │HOLD  │C03  │0    │ │
│ │  Caladan                    │A01   │  │  03 │034 │123 │MOVE  │D12  │3    │ │
│ │  Arrakis                    │C03   │  │  12 │124 │34  │GUARD │C03  │0    │ │
│ │  Giedi Prime                │HUB   │  │  15 │69  │69  │BOMB  │B09  │4    │ │
│ │  Ix                         │B09   │  │     │    │    │      │     │     │ │
│ └────────────────────────────────────┘  └──────────────────────────────────┘ │
│                                                                              │
│ ┌─ Alpha Fleet Details ────────────────────────────────────────────────────┐ │
│ │ Location: Arrakis      Orders: PATROL (03)      ROE: 7                   │ │
│ │                                                                          │ │
│ │ Ships                │ WEP │ AS/DS │ Combat State                        │ │
│ │ ─────────────────────┼─────┼───────┼─────────────────────────────────────│ │
│ │ > Light Cruiser      │ 02  │ 48/32 │ Nominal                             │ │
│ │   Frigate            │ 01  │ 36/24 │ Crippled                            │ │
│ │   Raider             │ 06  │ 12/45 │ Nominal                             │ │
│ │   Troop Transport    │ 01  │ 10/15 │ Crippled                            │ │
│ │   ETAC               │ 01  │ 10/30 │ Nominal                             │ │
│ │                                                                          │ │
│ │ Aux Ships:  2 ETAC, 4 Troop Transports (8 MD loaded)                     │ │
│ └──────────────────────────────────────────────────────────────────────────┘ │
│                                                                              │
│ [C]ommand [R]OE [Z]ero Turn                                                  │
└──────────────────────────────────────────────────────────────────────────────┘
----

Interaction rules:
* Fleet commands apply to multi-selected fleets only.
* Zero-turn applies to multi-selected ships in the focused fleet.
* Selection scope follows pane focus (fleets vs ships).

Column width note (draft):
* Systems pane: Name 29, Sector 6
* Fleet list: Fleet 5, AS 4, DS 4, CMD 6, DST 5, ETA 5
* Ship list: Ships 22, WEP 5, AS/DS 7, State 37

Key map (draft):
* `C` Command (apply to selected fleets)
* `R` ROE (apply to selected fleets)
* `Z` Zero Turn (apply to selected ships)
* `X` Toggle selection (fleet list or ship list)

== Visual Language

=== Palette (Classic EC ANSI)
|===
| Element | Foreground | Background | ANSI
| HUD background | Amber | Navy | 33 on 44
| Main canvas | White/Gray | Black | 37/90 on 40
| Alert glyph | Red | - | 91
| Selected row | Black | Cyan | 30 on 46
| Disabled/fog | Dark gray | - | 90
| Positive delta | Green | - | 92
| Negative delta | Red | - | 91
| Prestige | Yellow | - | 93
|===

=== Borders and Typography
* Primary panels: double-line `═║╔╗╚╝╠╣╦╩╬`
* Dialogs/overlays: single-line `─│┌┐└┘├┤┬┴┼`
* Subtle grouping: dotted `···` or light box `╌`
* Headings: ALL CAPS, left-aligned
* Monospace alignment: 2-space gutters, 80-char line limit in content

=== Glyphs
|===
| Glyph | Meaning
| `★` | Prestige
| `●` | OK / Neutral diplomatic status
| `⚠` | Needs Attention / Hostile status
| `⚔` | Enemy diplomatic status
| `☠` | Eliminated
| `RSV` | Reserve status
| `MTB` | Mothballed status
| `▲▼` | Trend up/down
| `✉` | Unread message/report
| `▓░` | Progress bar
|===

== Input Model

=== Navigation
----
[1-9]           Switch primary views
[Tab/S-Tab]     Cycle focusable widgets within view
[Enter]         Drill into selected item / confirm action
[Backspace]     Step up breadcrumb history
[Esc]           Cancel overlay / exit command mode
[?]             Show context help overlay
[L]             Diplomatic matrix overlay (from Overview)
----

=== Letter Mnemonics
Within views, single-letter hotkeys trigger common actions:

|===
| Key | Context | Action
| `M` | Fleet selected | Move command
| `P` | Fleet selected | Patrol command
| `H` | Fleet selected | Hold command
| `G` | Fleet selected | Guard (colony or starbase)
| `R` | Fleet selected | ROE picker overlay
| `J` | Fleet selected | Join fleet
| `B` | Colony selected | Build (construction queue)
| `T` | Economy view | Adjust tax rate
| `L` | Overview | Diplomatic matrix overlay
| `D` | Reports | Delete selected report
| `X` | Multi-select | Toggle selection on current row
| `A` | Proposals | Accept proposal
| `R` | Proposals | Reject proposal
|===

=== Expert Mode
Typing `:` enters command mode in the status bar. The input appears in the
bottom status bar line, with a helix-style completion palette floating above.

Example commands:
----
:move alpha B7
:patrol delta
:roe sigma 8
:build bigun cruiser 3
:tax 45
:research erp 50
:buy ebp 3
----

== Entry Modal

=== Layout (72 columns max)
----
┌────────────────────────────────────────────────────────────────────────┐
│                              E C 4 X                                   │
├────────────────────────────────────────────────────────────────────────┤
│                                                                        │
│  ███████╗ ██████╗██╗  ██╗██╗  ██╗                                      │
│  ██╔════╝██╔════╝██║  ██║╚██╗██╔╝                                      │
│  █████╗  ██║     ███████║ ╚███╔╝                                       │
│  ██╔══╝  ██║     ╚════██║ ██╔██╗                                       │
│  ███████╗╚██████╗     ██║██╔╝ ██╗                                      │
│  ╚══════╝ ╚═════╝     ╚═╝╚═╝  ╚═╝                                      │
│                                                                        │
│  IDENTITY ─────────────────────────────────────────────────────────    │
│  npub1q3z...7xkf (local)                          [I] Import nsec      │
│                                                                        │
│  YOUR GAMES ───────────────────────────────────────────────────────    │
│► Alpha Campaign    T42   House Valerian                                │
│  Beta Skirmish     T18   House Stratos                                 │
│                                                                        │
│  OPEN LOBBIES ─────────────────────────────────────────────────────    │
│  New Galaxy        (3/6 players)                                       │
│                                                                        │
├────────────────────────────────────────────────────────────────────────┤
│  [↑/↓] Select   [Enter] Play   [I] Import   [Q] Quit       v0.1.0      │
└────────────────────────────────────────────────────────────────────────┘
----

=== Sections
* Identity: truncated npub + type label, import hint right-aligned.
* Your Games: game name, turn, house name, cursor for selection.
* Open Lobbies: game name, player count.
* Footer: hotkey hints + version.

== Status Bar

=== Normal Mode
----
<1> OVERVIEW  <2> PLANETS  <3> FLEETS  <4> RESEARCH  ... <:> EXPERT
----

=== Expert Mode
----
:move alpha B7_
----

== Open Questions
* Final list of view-specific hotkeys per screen.
* Which views require dual-column vs single-column at 80 columns.
* Confirm whether OPEN LOBBIES appears in entry modal (current TUI does not).
