= EC4X TUI Design Spec
:status: Draft
:scope: Design only (no runtime config)

== Purpose
Define the EC4X text UI layout, navigation, and visual language for
implementation in `src/player/`. This is a design spec only. It does not
introduce runtime configuration or a layout engine.

== Goals
* Preserve the classic EC atmosphere while improving usability.
* Keep always-on empire context visible across views.
* Support fast keyboard navigation with clear hotkey hints.
* Maintain consistent, reusable UI patterns.

== Non-Goals
* Hot reload or runtime layout configuration.
* Fully declarative widget trees.
* Reusable UI framework for other games.

== Viewport Targets
* Minimum supported width: 120 columns
* Target height: 32+ rows

Responsive rules:
* If width < 120, block UI and show a terminal-too-narrow message.
* Suggested message: `Terminal too narrow (need 120 cols, have NN).`

Example (narrow terminal):
----
┌────────────────────────────────────────────────────────────────────────┐
│                                                                        │
│        Terminal too narrow (need 120 cols, have 96).                   │
│                                                                        │
│        Resize your terminal to continue.                               │
│                                                                        │
└────────────────────────────────────────────────────────────────────────┘
----

== Screen Regions
----
+------------------------------------------------------------------------------+
| HUD STRIP (2 lines)                                                          |
|   Left: Empire + Turn    Center: Prestige/Treasury/Prod/C2    Right: Alerts  |
+------------------------------------------------------------------------------+
| BREADCRUMB LINE (1 line)                                                     |
|   Home > Fleets > Alpha Patrol                                               |
+------------------------------------------------------------------------------+
|                                                                              |
| MAIN CANVAS (variable height)                                                |
|   - All windows in the main canvas are modal overlays                        |
|   - Centered floating modals for 9 primary views                             |
|   - Single-line borders (--) for modals and overlays                         |
|                                                                              |
+------------------------------------------------------------------------------+
| STATUS BAR (1 line)                                                          |
|   <O> OVR  <C> CLN  <F> FLT ... <:> EXPERT    or    :command input_          |
+------------------------------------------------------------------------------+
----

== Shared Systems

=== Intel Freshness (LTU)
LTU tracks intel freshness for the player view (fog-of-war), not authoritative
game state.

LTU storage in PlayerState:
* ltuSystems: Table[SystemId, int32]
* ltuColonies: Table[ColonyId, int32]
* ltuFleets: Table[FleetId, int32]
* No ship-level LTU

LTU rules:
* Owned assets: LTU = current turn.
* Uncolonized systems: use ltuSystems[systemId] or "—".
* Colonized systems: use ltuColonies[colonyId] if present, else fall back to
  ltuSystems[systemId].

== Primary Views (Global Alt+Key)
* `Alt+O` Overview     (Info Dashboard)
* `Alt+R` Reports      (Turn Reports / Event Inbox)
* `Alt+G` General      (Diplomacy & Empire Policy)
* `Alt+C` Colony       (Colony Management)
* `Alt+F` Fleet        (Fleet Operations)
* `Alt+T` Tech         (Research & Development)
* `Alt+E` Espionage    (Intel Operations & Budget)
* `Alt+I` Intel db     (Starmap Database)
* `Alt+S` Settings     (Client Configuration)
* `Alt+Q` Quit

=== Overview (`O`)
Dashboard summary of the current turn state.
* **Vital Signs**: Treasury (PP), Prestige, Current Turn.
* **Aggregates**: Total Population (PU), Total Colony Count, Total Ships.
* **Standing**: Current Rank (from Leaderboard).
* **Alerts**: Critical warnings (Invasions, Shortfalls).

=== Reports (`R`)
Comprehensive inbox of all `GameEvent`s generated during the turn resolution.
* Categories: Combat, Economy, Diplomacy, Espionage, Tech, General.
* Functionality: Filter by category, Mark Read, Delete.
* Detail view for complex events (Combat Reports).

=== General (`G`)
Empire-wide management and foreign policy.
* **Diplomacy**:
  - View diplomatic status (Neutral/Hostile/Enemy) with other Houses.
  - Issue `DiplomaticCommand`: Declare War, Propose Peace, Accept/Reject Treaties.
* **Empire Policy**:
  - Global Tax Rate: Slider that generates `ColonyManagementCommand` updates for all colonies.
  - Policy Defaults: Global toggles for Auto-Repair, Auto-Load (applied to all colonies).

=== Colony View (`C`)
Management of owned and administered colonies.
Intent: a single full-width modal table in the Main Canvas.
Note: LTU is not shown here as owned colonies always have perfect, real-time intel.

Ordering:
* Homeworld pinned to the top.
* Remaining owned systems alphabetical by system name.

Columns (120 cols target):
* System (name)
* Sec (system coords)
* Cls (planet class)
* Res (resource rating)
* Pop (PU)
* IU
* GCO
* NCV
* Δ (population growth)
* CD (construction dock capacity)
* RD (repair dock capacity)
* Flt (fleets in system)
* SB (starbases)
* A+M (ground units: armies + marines)
* GB (ground batteries)
* Sld (planetary shield: Y/N)
* Status (comma-separated flags)

Column budget (120 cols target):
* System: 14
* Sec: 4
* Cls: 3
* Res: 3
* Pop: 4
* IU: 4
* GCO: 5
* NCV: 5
* Δ: 5
* CD: 2
* RD: 2
* Flt: 2
* SB: 2
* A+M: 2
* GB: 2
* Sld: 3
* Status: 0 (auto-width, minWidth 4, expands to fill remaining width)

Column alignment spec:
----
System: width=14  align=left   truncate=ellipsis
Sec:    width=4   align=center truncate=none
Cls:    width=3   align=center truncate=none
Res:    width=3   align=center truncate=none
Pop:    width=4   align=center truncate=none
IU:     width=4   align=center truncate=none
GCO:    width=5   align=center truncate=none
NCV:    width=5   align=center truncate=none
Δ:      width=5   align=center truncate=none
CD:     width=2   align=center truncate=none
RD:     width=2   align=center truncate=none
Flt:    width=2   align=center truncate=none
SB:     width=2   align=center truncate=none
A+M:    width=2   align=center truncate=none
GB:     width=2   align=center truncate=none
Sld:    width=3   align=center truncate=none
Status: width=0   align=center truncate=ellipsis (auto, minWidth=4)
----

Table sketch (borderless zebra-striped):
----
SYSTEM          Sec  Cls Res Pop  IU   GCO   NCV    Δ   CD RD Flt SB A+M GB Sld Status
─────────────────────────────────────────────────────────────────────────────────────────
Caladan         A01  BEN RIC 120  80   400   220  +1.2 10  8  2  1  20  5   Y  OK
Arrakis         C03  HRH ABD  60  40   180    96  +0.6  6  4  5  0   0  2   N  CN, TF
Ix              B09  LSH RIC  90  70   320   180  +0.9  8  6  0  1   5  2   Y  ⚠ BLK, CAP, DMG
----

NOTE: The actual rendering uses `showBorders(false)` and `zebraStripe(true)`, producing
a compact list view without box characters. Alternate rows receive subtle background tinting
for readability.

Status legend (prioritized):
* BLK: Blockaded (Critical)
* CAP: Capacity Violation (Hangar/Garrison)
* DMG: Infrastructure/Facility Damage
* RPR: Repairing
* TF:  Terraforming active
* CN:  Construction active
* OK:  Nominal

==== Colony Modal Variant

For detail/modal views, a bordered table variant (`buildPlanetsTable`) is available with
slightly different styling:

* Uses `showBorders(true)` for full box drawing
* Right-aligns numeric columns (Pop, IU, GCO, NCV, Δ, CD, RD, Flt, SB, Gnd, Bat) instead of center
* Status column: width=4, left-aligned (fixed width instead of auto)
* Column headers use "Grw" instead of "Δ", "Gnd" instead of "A+M", "Bat" instead of "GB", "Shd" instead of "Sld"

This variant is used when presenting colony data in a focused modal context where the
bordered presentation provides better visual separation from surrounding UI elements.

Example (bordered modal):
----
┌────────────────────────────────────────────────────────────────────────────────────────┐
│SYSTEM          Sec  Cls Res  Pop   IU   GCO   NCV   Grw CD RD Flt SB Gnd Bat Shd Status│
├────────────────────────────────────────────────────────────────────────────────────────┤
│Caladan         A01  BEN RIC  120   80   400   220  +1.2 10  8  2  1  20  5   Y  OK     │
│Arrakis         C03  HRH ABD   60   40   180    96  +0.6  6  4  5  0   0  2   N  CN     │
└────────────────────────────────────────────────────────────────────────────────────────┘
----

* **Commands**:
  - `BuildCommand`: Ships, Facilities, Ground Units.
  - `ScrapCommand`: Recycling assets.
  - `RepairCommand`: Manual repairs.
  - `TerraformCommand`: Planetary engineering.
  - `PopulationTransferCommand`: Migration.
  - `ColonyManagementCommand`: Tax rates, auto-repair toggles (per-colony override).

=== Fleet View (`F`)
Command and Control for fleets.
* **Table View**: Lists fleets with location, composition, and orders.
* **Detail View**: Ship-level status and cargo.
* **Commands**:
  - `FleetCommand`: Move, Patrol, Hold, Guard, Attack (Bombard/Invade/Blockade/Blitz),
    Colonize, Scout, Merge, Split.
  - `ZeroTurn`: Rename, Scrap ships.

=== Fleet Command Console (`F` - Detailed)
Intent: fast, multi-fleet command and per-ship zero-turn management.

Layout sketch:
----
┌─ EC4X Fleet Command ─ Turn 12 ─ House Atreides ──────────────────────────────┐
│                                                                              │
│ ┌─ Systems (5) ──────────────────────┐  ┌─ Arrakis (3) ────────────────────┐ │
│ │SYSTEM                       │SECT  │  │FLEET│AS  │DS  │CMD   │DST  │ETA  │ │
│ │─────────────────────────────┼──────│  │─────┼────┼────┼──────┼─────┼─────│ │
│ │> Spatharokandidatos         │D07   │  │> 02 │100 │300 │HOLD  │C03  │0    │ │
│ │  Caladan                    │A01   │  │  03 │034 │123 │MOVE  │D12  │3    │ │
│ │  Arrakis                    │C03   │  │  12 │124 │34  │GUARD │C03  │0    │ │
│ │  Giedi Prime                │HUB   │  │  15 │69  │69  │BOMB  │B09  │4    │ │
│ │  Ix                         │B09   │  │     │    │    │      │     │     │ │
│ └────────────────────────────────────┘  └──────────────────────────────────┘ │
│                                                                              │
│ ┌─ Alpha Fleet Details ────────────────────────────────────────────────────┐ │
│ │ Location: Arrakis      Orders: PATROL (03)      ROE: 7                   │ │
│ │                                                                          │ │
│ │ Ships                │ WEP │ AS/DS │ Combat State                        │ │
│ │ ─────────────────────┼─────┼───────┼─────────────────────────────────────│ │
│ │ > Light Cruiser      │ 02  │ 48/32 │ Nominal                             │ │
│ │   Frigate            │ 01  │ 36/24 │ Crippled                            │ │
│ │   Raider             │ 06  │ 12/45 │ Nominal                             │ │
│ │   Troop Transport    │ 01  │ 10/15 │ Crippled                            │ │
│ │   ETAC               │ 01  │ 10/30 │ Nominal                             │ │
│ │                                                                          │ │
│ │ Aux Ships:  2 ETAC, 4 Troop Transports (8 MD loaded)                     │ │
│ └──────────────────────────────────────────────────────────────────────────┘ │
│                                                                              │
│ [C]ommand [R]OE [Z]ero Turn                                                  │
└──────────────────────────────────────────────────────────────────────────────┘
----

Interaction rules:
* Fleet commands apply to multi-selected fleets only.
* Zero-turn applies to multi-selected ships in the focused fleet.
* Selection scope follows pane focus (fleets vs ships).

Column width note (draft):
* Systems pane: Name 29, Sector 6
* Fleet list: Fleet 5, AS 4, DS 4, CMD 6, DST 5, ETA 5
* Ship list: Ships 22, WEP 5, AS/DS 7, State 37

Key map (draft):
* `C` Command (apply to selected fleets)
* `R` ROE (apply to selected fleets)
* `Z` Zero Turn (apply to selected ships)
* `X` Toggle selection (fleet list or ship list)

=== Tech View (`T`)
Research and Development management.
* **Allocation**: Slider/Input for `ResearchAllocation` (Economic vs Science vs Tech Fields).
* **Tree Status**: View current levels and progress towards next level.
* **Breakthroughs**: View recent tech breakthroughs.

=== Espionage View (`E`)
Intelligence and Counter-Intelligence operations.
* **Budget**: Set `ebpInvestment` (Offensive) and `cipInvestment` (Defensive).
* **Operations**: Issue `EspionageAttempt` orders (Spy, Sabotage, Steal Tech).
* **Network**: View infiltration status on target Houses.

=== Intel db (`I`)
Read-only database of the known galaxy. Complements the SVG Starmap.

Note on LTU: This view HEAVILY relies on `PlayerState.ltuSystems` and `ltuColonies`.
Data shown here reflects the *last known state* of a system, not the current engine state.
Users should check the LTU column to judge the staleness of the intelligence.

* **Scope**: All known systems (Owned, Enemy, Neutral, Unexplored).
* **Data**: Planet Class, Resource Rating, Star Type, Coordinates.
* **Function**: Reference for planning colonization or conquest.
* **LTU Display**: All rows must clearly show the turn of the last update.

Columns (Draft):
* System (Name)
* Sector (Coords)
* Known Owner (Last seen owner)
* Intel (Scan/Vis/Full)
* LTU (Turn number of last update)
* Notes (Artifacts, anomalies, etc.)

=== Settings (`S`)
Client-side configuration.
* TUI Theme/Colors.
* Keybindings.
* Notification preferences.

== Visual Language

=== Theme Strategy
The TUI uses a semantic theme system rather than hardcoded colors.
Target Aesthetic: **Tokyo Night** (Deep charcoal backgrounds, slate borders, high-contrast accents).

|===
| Semantic Role | Default "Tokyo Night" | Usage
| `Surface.Main`      | #1a1b26 (Charcoal) | Main window backgrounds
| `Surface.Panel`     | #24283b (Deep Blue)| Sidebars, headers
| `Surface.Overlay`   | #2f334d (Slate)    | Modals, dropdowns
| `Border.Primary`    | #565f89 (Blue-Grey)| Active window borders
| `Border.Dim`        | #414868 (Dark Grey)| Inactive borders
| `Text.Primary`      | #c0caf5 (White-ish)| Standard text
| `Text.Muted`        | #565f89 (Grey)     | Labels, hints
| `State.Info`        | #7aa2f7 (Blue)     | Info, selection
| `State.Success`     | #9ece6a (Green)    | Growth, positive delta, safe
| `State.Warning`     | #e0af68 (Orange)   | Warnings, low supplies
| `State.Error`       | #f7768e (Red)      | Alerts, damage, enemies
| `State.Accent`      | #bb9af7 (Purple)   | Prestige, key focus items
|===

=== Borders and Typography
* Primary panels: double-line `═║╔╗╚╝╠╣╦╩╬`
* Dialogs/overlays: single-line `─│┌┐└┘├┤┬┴┼`
* Subtle grouping: dotted `···` or light box `╌`
* Headings: ALL CAPS, left-aligned
* Monospace alignment: 2-space gutters, 80-char line limit in content

=== Glyphs
|===
| Glyph | Meaning
| `★` | Prestige
| `●` | OK / Neutral diplomatic status
| `⚠` | Needs Attention / Hostile status
| `⚔` | Enemy diplomatic status
| `☠` | Eliminated
| `RSV` | Reserve status
| `MTB` | Mothballed status
| `▲▼` | Trend up/down
| `✉` | Unread message/report
| `▓░` | Progress bar
|===

== Input Model

=== Navigation
----
[Alt + Key]       Switch primary views (e.g., Alt+F for Fleets)
[Tab/S-Tab]       Cycle focusable widgets within view
[Enter]           Drill into selected item / confirm action
[Esc]             Step up breadcrumb / Cancel overlay / Exit mode
[?]               Show context help overlay
----

=== Context Commands
Within views, single-letter hotkeys trigger actions on the *selected item*:

|===
| Key | Context | Action
| `m` | Fleet selected | Move command
| `p` | Fleet selected | Patrol command
| `h` | Fleet selected | Hold command
| `g` | Fleet selected | Guard (colony or starbase)
| `r` | Fleet selected | ROE picker overlay
| `j` | Fleet selected | Join fleet
| `b` | Colony selected | Build (construction queue)
| `t` | Colony selected | Adjust tax rate
| `l` | General | Diplomatic matrix overlay
| `d` | Reports | Delete selected report
| `x` | Multi-select | Toggle selection on current row
| `a` | Proposals | Accept proposal
| `r` | Proposals | Reject proposal
|===

=== Expert Mode
Typing `:` enters command mode in the status bar. The input appears in the
bottom status bar line, with a helix-style completion palette floating above.

Example commands:
----
:move alpha B7
:patrol delta
:roe sigma 8
:build bigun cruiser 3
:tax 45
:research erp 50
:buy ebp 3
----

== Entry Modal

=== Layout (72 columns max)
----
┌────────────────────────────────────────────────────────────────────────┐
│                              E C 4 X                                   │
├────────────────────────────────────────────────────────────────────────┤
│                                                                        │
│  ███████╗ ██████╗██╗  ██╗██╗  ██╗                                      │
│  ██╔════╝██╔════╝██║  ██║╚██╗██╔╝                                      │
│  █████╗  ██║     ███████║ ╚███╔╝                                       │
│  ██╔══╝  ██║     ╚════██║ ██╔██╗                                       │
│  ███████╗╚██████╗     ██║██╔╝ ██╗                                      │
│  ╚══════╝ ╚═════╝     ╚═╝╚═╝  ╚═╝                                      │
│                                                                        │
│  IDENTITY ─────────────────────────────────────────────────────────    │
│  npub1q3z...7xkf (local)                          [I] Import nsec      │
│                                                                        │
│  YOUR GAMES ───────────────────────────────────────────────────────    │
│► Alpha Campaign    T42   House Valerian                                │
│  Beta Skirmish     T18   House Stratos                                 │
│                                                                        │
│  OPEN LOBBIES ─────────────────────────────────────────────────────    │
│  New Galaxy        (3/6 players)                                       │
│                                                                        │
├────────────────────────────────────────────────────────────────────────┤
│  [↑/↓] Select   [Enter] Play   [I] Import   [Q] Quit       v0.1.0      │
└────────────────────────────────────────────────────────────────────────┘
----

== Status Bar

=== Normal Mode
----
<Alt+O> OVR  <Alt+C> CLN  <Alt+F> FLT  <Alt+T> TECH  ... <:> EXPERT
----

=== Expert Mode
----
:move alpha B7_
----
